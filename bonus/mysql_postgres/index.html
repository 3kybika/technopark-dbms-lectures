<!DOCTYPE html>
<html lang="ru">
<head>
	<title>СУБД. Mysql vs docker</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="Hugo 0.92.2" />
	
	<link rel="icon" href="../../common/lecture.png" />
	
	<link rel="stylesheet" href="../../shower/themes/ribbon/styles/screen-16x10.css">
	<link rel="stylesheet" href="../../css/style.css">
	<link rel="stylesheet" href="../../highlight.js/styles/idea.min.css">
</head>
<body class="shower list no-math">
	<header class="caption">
		<h1>СУБД. Mysql vs docker</h1>
	</header>
	
<section class="slide white" style="padding: 0" id="cover">
    <svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="-10 -10 895 645"
            width="100%"
            height="100%"
            style="background-image: url(../../park.mail.ru/img/back.png)"
            version="1.1">
        <image
                xlink:href="../../park.mail.ru/img/blocks.svg"
                width="718"
                height="548"
                preserveAspectRatio="none"
                x="157"
                y="67"/>
		<image
                xlink:href="../../park.mail.ru/img/logo.svg"
                width="297"
                height="130"
                preserveAspectRatio="none"
                x="0"
                y="0"/>
        <g style="font-family: 'PF Isotext Pro', sans-serif; font-size: 32px; font-stretch: semi-condensed">
            <foreignObject x="177" y="204" width="514" height="202">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center">
                    <div style="vertical-align: middle; display: table-cell; padding-bottom: 20px; font-weight: bold">
                        СУБД
                    </div>
                </div>
            </foreignObject>
            <foreignObject x="534" y="534" width="326" height="65">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center; font-size: 28px">
                    <div style="vertical-align: middle; display: table-cell; font-size: 22px;">
                        Алехин Владислав
                    </div>
                </div>
            </foreignObject>
            <foreignObject x="177" y="465" width="240" height="134">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: left">
                    <div style="vertical-align: top; display: table-cell">
                        Mysql vs docker
                    </div>
                </div>
            </foreignObject>
        <g>
    </svg>
</section>

	<div>
    <style>
         tr.read {
            background: linear-gradient(
                    -45deg,
                    transparent 49.9%,
                    skyblue 49.9%,
                    skyblue 60%,
                    transparent 60%
            ), linear-gradient(
                    -45deg,
                    skyblue 10%,
                    transparent 10%
            );
            background-size: 8px 8px;
        }

        tr.update {
            background-color: #ffb !important;
        }

        tr.delete {
            background-color: #fbb !important;
        }

        tr.insert {
            background-color: #bfb !important;
            font-weight: bold;
        }

        .changed {
            font-weight: bold;
        }

        .obsolete {
            font-style: italic;
        }

        .label-l, .label-r {
            position: absolute;
            padding-top: 2px;
            height: 36px;
            font-size: 80%;
            font-weight: bold;
            font-style: normal;
        }

        .label-l {
            left: 100px;
            width: 99px;
            padding-left: 6px;
        }

        .label-l:after {
            content: "";
            position: absolute;
            top: 0px;
            left: 98px;
            height: 36px;
            width: 19px;
            border: 18px solid transparent;
            border-right: 0;
        }

        .update .label-l {
            background-color: #ffb;
        }

        .delete .label-l {
            background-color: #fbb;
        }

        .insert .label-l {
            background-color: #bfb;
        }

        .update .label-l:after {
            border-left-color: #ffb;
        }

        .delete .label-l:after {
            border-left-color: #fbb;
        }

        .insert .label-l:after {
            border-left-color: #bfb;
        }

        .read .label-r {
            background-color: #bbf;
        }

        .read .label-r:before {
            border-right-color: #bbf;
        }

        .label-r {
            right: 100px;
            width: 99px;
            padding-left: 6px;
        }

        .label-r:before {
            content: "";
            position: absolute;
            top: 0px;
            right: 98px;
            height: 36px;
            width: 19px;
            border: 18px solid transparent;
            border-left: 0;
        }

        .mvcc {
            margin-left: 120px;
            margin-right: 120px;
        }

        .mvcc table {
            width: 100%;
        }

        .tx-r, .tx-g, .tx-y {
            text-align: center;
        }

        .tx-r {
            background-color: #fbb !important;
        }

        .tx-g {
            background-color: #bfb !important;
        }

        .tx-y {
            background-color: #ffb !important;
        }
    </style>
</div>


<section class="slide">
    <h2>О чем поговорим?</h2>
    <img src="docker.svg" style="position: absolute; bottom: 50px; right: 50px; width: 320px"/>
    <ul>
        <li>Сравнение функциональности</li>
        <li>Процессная/потоковая модель сервера</li>
        <li>Путь выполнения запроса</li>
        <li>MVCC</li>
        <li>Индекс</li>
    </ul>
</section>

<section class="slide">
    <h2>Cравнение функциональности</h2>
    <table style="font-size: 60%">
        <thead>
        <tr>
            <th style="text-align: right">Функция</th>
            <th style="text-align: right">PostgreSQL 14+</th>
            <th style="text-align: right">MySQL 8+</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>CTE</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>Декларативное секционирование</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>Полнотекстовый поиск</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>GIS и SRS</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>JSON</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>Логическая репликация</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>Полусинхронная репликация</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>Оконные функции</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        <tr>
            <td>Транзакционный DDL</td>
            <td align="right">Есть</td>
            <td align="right">Есть</td>
        </tr>
        </tbody>
    </table>

</section>


<section class="slide">
    <h2 class="shout">Процессы и потоки</h2>
</section>


<section class="slide">
    <h2>Процессы Postgresql</h2>
    <img src="pg_process_model.png" style="max-width: 1000px;margin-left: -75px;" />
</section>


<section class="slide">
    <h2>Процессы Postgresql</h2>
    <img src="pg_ps.png" style="max-width: 825px;" />
</section>


<section class="slide">
    <h2>Процессы MySQL</h2>
    <img src="mysql_ps.png" style="max-width: 825px;" />
</section>


<section class="slide">
    <h2>Процессы MySQL</h2>
    <img src="mysql_showprocesslist.png" style="max-width: 825px;" />
</section>


<section class="slide">
    <h2>Connection pool</h2>
    <table class="classic bordered" style="font-size: 100%">
        <thead>
        <tr>
            <th style="text-align: right">PostgreSQL</th>
            <th style="text-align: right">MySQL</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td align="right">PGPool или PgBouncer</td>
            <td align="right">Client-side connection pool</td>
        </tr>
        </tbody>
    </table>
</section>


<section class="slide">
    <h2>Путь запроса Postgresql</h2>
    <img src="pg_query_path.png" style="max-width: 1000px;margin-left: 100px; max-height: 500px;"/>
</section>


<section class="slide">
    <h2>Путь запроса MySQL</h2>
    <img src="mysql_structure.png" style="max-width: 1000px;margin-left: 100px; max-height: 500px;"/>
</section>


<section class="slide">
    <h2 class="shout">Статистика</h2>
</section>


<section class="slide">
    <h2>Статистика по таблицам</h2>
    <table style="font-size: 100%">
        <thead>
        <tr>
            <th style="text-align: right">MySQL</th>
            <th style="text-align: right">PostgreSQL</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td align="right">Размер кластерного индекса</td>
            <td align="right">Размер таблицы</td>
        </tr>
        <tr>
            <td align="right">Количество строк</td>
            <td align="right">Количество строк</td>
        </tr>
        <tr>
            <td align="right">&nbsp;</td>
            <td align="right">Количество страниц в памяти</td>
        </tr>
        </tbody>
    </table>
</section>


<section class="slide">
    <h2>Статистика по атрибутам</h2>
    <table style="font-size: 100%">
        <thead>
        <tr>
            <th style="text-align: right">MySQL</th>
            <th style="text-align: right">PostgreSQL</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td align="right">Распределение данных, в том числе доля NULL-значений</td>
            <td align="right">Распределение данных, в том числе доля NULL-значений</td>
        </tr>
        <tr>
            <td align="right">&nbsp;</td>
            <td align="right">Средний размер колонки в байтах</td>
        </tr>
        <tr>
            <td align="right">&nbsp;</td>
            <td align="right">Количество уникальных значений</td>
        </tr>
        <tr>
            <td align="right">&nbsp;</td>
            <td align="right">Статистическая корреляция между физическим порядком строк и логическим порядком значений столбца</td>
        </tr>
        <tr>
            <td align="right">&nbsp;</td>
            <td align="right">Наиболее часто встречаемые значения и их частота</td>
        </tr>
        </tbody>
    </table>
</section>


<section class="slide">
    <h2>Межаттрибутная статистика</h2>
    <table style="font-size: 100%">
        <thead>
        <tr>
            <th style="text-align: right">MySQL</th>
            <th style="text-align: right">PostgreSQL</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td align="right">&nbsp;</td>
            <td align="right">Функциональные зависимости</td>
        </tr>
        <tr>
            <td align="right">&nbsp;</td>
            <td align="right">Количество уникальных значений</td>
        </tr>
        </tbody>
    </table>
</section>


<section class="slide">
    <h2 class="shout">ACID</h2>
</section>


<section class="slide">
    <h2>ACID</h2>
    <p>ACID описывает требования к транзакционной системе, обеспечивающие наиболее надёжную и предсказуемую её работу.</p>
    <ul>
        <li><b>A</b>tomicity — Атомарность</li>
        <li><b>C</b>onsistency — Согласованность</li>
        <li><b>I</b>solation — Изолированность</li>
        <li><b>D</b>urability — Долговечность</li>
    </ul>
</section>


<section class="slide">
    <h2 class="shout">MVCC</h2>
</section>



<section class="slide">
    <h2>UPDATE IN PLACE 1: TABLE</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>Alice</td>
                <td>Great at programming</td>
            </tr>
            <tr>
                <td>2</td>
                <td>Bob</td>
                <td>Always talking to alice</td>
            </tr>
            <tr>
                <td>3</td>
                <td>Eve</td>
                <td>Listens to everyone's conversations</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="slide">
    <h2>UPDATE IN PLACE 2: SCAN</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr class="read">
                <td>1</td>
                <td>Alice</td>
                <td>
                    <div class="label-r">read</div>
                    Great at programming
                </td>
            </tr>
            <tr class="read">
                <td>2</td>
                <td>Bob</td>
                <td>Always talking to alice</td>
            </tr>
            <tr class="read">
                <td>3</td>
                <td>Eve</td>
                <td>Listens to everyone's conversations</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="slide">
    <h2>UPDATE IN PLACE 3: UPDATE</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>Alice</td>
                <td>Great at programming</td>
            </tr>
            <tr class="update">
                <td>
                    <div class="label-l">~ update</div>
                    2
                </td>
                <td>Bob</td>
                <td>Always talking to alice</td>
            </tr>
            <tr>
                <td>3</td>
                <td>Eve</td>
                <td>Listens to everyone's conversations</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="slide">
    <h2>UPDATE IN PLACE 4: UPDATED</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>Alice</td>
                <td>Great at programming</td>
            </tr>
            <tr class="update">
                <td>
                    <div class="label-l">~ update</div>
                    2
                </td>
                <td>Bob</td>
                <td class="changed">Working very hard</td>
            </tr>
            <tr>
                <td>3</td>
                <td>Eve</td>
                <td>Listens to everyone's conversations</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="slide">
    <h2>UPDATE IN PLACE 5: INSERT</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>Alice</td>
                <td>Great at programming</td>
            </tr>
            <tr class="update">
                <td>2</td>
                <td>Bob</td>
                <td class="changed">Working very hard</td>
            </tr>
            <tr>
                <td>3</td>
                <td>Eve</td>
                <td>Listens to everyone's conversations</td>
            </tr>
            <tr class="insert">
                <td>
                    <div class="label-l">+ insert</div>
                    4
                </td>
                <td>Dave</td>
                <td>Very promising new-hire</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="slide">
    <h2>UPDATE IN PLACE 6: DELETE</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>Alice</td>
                <td>Great at programming</td>
            </tr>
            <tr class="update">
                <td>2</td>
                <td>Bob</td>
                <td class="changed">Working very hard</td>
            </tr>
            <tr class="delete">
                <td>
                    <div class="label-l">- delete</div>
                    3
                </td>
                <td>Eve</td>
                <td>Listens to everyone's conversations</td>
            </tr>
            <tr class="insert">
                <td>4</td>
                <td>Dave</td>
                <td>Very promising new-hire</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="slide">
    <h2>UPDATE IN PLACE 7</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>1</td>
                <td>Alice</td>
                <td>Great at programming</td>
            </tr>
            <tr class="update">
                <td>2</td>
                <td>Bob</td>
                <td class="changed">Working very hard</td>
            </tr>
            <tr class="insert">
                <td>4</td>
                <td>Dave</td>
                <td>Very promising new-hire</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section class="slide">
    <h2>UPDATE IN PLACE 8: REALITY</h2>
    <div class="mvcc">
        <table class="classic bordered">
            <thead>
            <tr>
                <th>id</th>
                <th>name</th>
                <th>notes</th>
            </tr>
            </thead>
            <tbody>
            <tr class="read">
                <td>1</td>
                <td>Alice</td>
                <td>
                    <div class="label-r">read</div>
                    Great at programming
                </td>
            </tr>
            <tr class="read update">
                <td>
                    <div class="label-l">+ update</div>
                    2
                </td>
                <td>Bob</td>
                <td class="read changed">Working very hard</td>
            </tr>
            <tr class="read delete">
                <td>
                    <div class="label-l">- delete</div>
                    3
                </td>
                <td>Eve</td>
                <td>Listens to everyone's conversations</td>
            </tr>
            <tr class="insert">
                <td>
                    <div class="label-l">+ insert</div>
                    4
                </td>
                <td>Dave</td>
                <td>Very promising new-hire</td>
            </tr>
            </tbody>
        </table>
    </div>
</section>


<section class="slide">
    <h2>MVCC MySQL InnoDB</h2>
    <img src="mvcc_mysql.png" style="max-width: 1000px;margin-left: 100px; max-height: 500px;" />
</section>


<section class="slide">
    <h2>Cравнение реализацйи MVCC</h2>
    <ul>
        <li>Размер версии объекта</li>
        <li>Insert</li>
        <li>Восстановление предыдущей версии в случае отката транзакции</li>
        <li>Освобождение места занятого старой версией</li>
        <li>Влияние задержек очистки мертвых кортежей</li>
        <li>Последовательное сканирование "распухшей таблицы"</li>
        <li>Индексы</li>
    </ul>
</section>


<section class="slide">
    <h2 class="shout">Индексы</h2>
</section>


<section class="slide">
    <h3>Индексы</h3>
    <p>Два основных типа архитектур индекса</p>
    <ul>
        <li>Кластерный индекс</li>
        <li>Некластерный индекс</li>
    </ul>
    <p>Связанные понятия</p>
    <ul>
        <li>Первичный индекс</li>
        <li>Вторичный индекс</li>
    </ul> 
</section>


<section class="slide">
    <h3>Индексы PostgreSQL</h3>
    <p>Все индексы являются некластерными (вторичными), так как хранятся в отдельной структуре в табличной куче</p>
    <img src="index_pg.png" style="max-width: 1000px;margin-left: -75px;"/>
</section>


<section class="slide">
    <h3>Индексы PostgreSQL</h3>
    <p>Есть поддержка составных, частичных, функциональных</p>
    <img src="create_index_pg.png" style="max-width: 820px;margin-left: -5px; max-height: 500px;"/>
</section>


<section class="slide">
    <h3>Индексы PostgreSQL</h3>
    <p>Большой выбор встроенных типов индексов:</p>
    <ul>
        <li>B-Tree</li>
        <li>Hash индекс</li>
        <li>GIN (Generalized Inverted Index)</li>
        <li>GiST (Generalized Search Tree)</li>
        <li>SP-GiST (Space Partitioned GiST)</li>
        <li>BRIN (Block Range Index)</li>
</section>


<section class="slide">
    <h3>Индексы в MySQL</h3>
    <p>В табличке может быть 1 кластерный и несколько некластерных индексов</p>
    <img src="index_mysql.png" style="max-width: 1000px;margin-left: -80px;"/>
</section>


<section class="slide">
    <h3>Индексы в MySQL</h3>
    <p>Есть поддержка составных, частичных, но нет поддержки функциональных</p> 
    <img src="create_index_mysql.png" style="max-width: 820px;margin-left: -5px; max-height: 500px;"/>
</section>


<section class="slide">
    <h3>Индексы PostgreSQL</h3>
    <p>Большой выбор встроенных типов индексов:</p>
    <ul>
        <li>B-Tree</li>
        <li>Hash индекс</li>
        <li>GIN (Generalized Inverted Index)</li>
        <li>GiST (Generalized Search Tree)</li>
        <li>Префиксные индексы</li>
</section>

	
<section class="slide white" style="padding: 0" id="contacts">
    <svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="-10 -10 895 645"
            width="100%"
            height="100%"
            style="background-image: url(../../park.mail.ru/img/back.png)"
            version="1.1">
        <image
                xlink:href="../../park.mail.ru/img/blocks.svg"
                width="718"
                height="548"
                preserveAspectRatio="none"
                x="157"
                y="67"/>
		<image
                xlink:href="../../park.mail.ru/img/logo.svg"
                width="297"
                height="130"
                preserveAspectRatio="none"
                x="0"
                y="0"/>
        <g style="font-family: 'PF Isotext Pro', sans-serif; font-size: 32px; font-stretch: semi-condensed">
            <foreignObject x="177" y="204" width="514" height="202">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center">
                    <div style="vertical-align: middle; display: table-cell; padding-bottom: 20px; font-weight: bold">
                        Алехин Владислав
                        
                        
                        <div>E-mail: v.alehin@corp.mail.ru</div>
                        
                    </div>
                </div>
            </foreignObject>
            <foreignObject x="534" y="534" width="326" height="65">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center; font-size: 28px; font-weight: bold">
                    <div style="vertical-align: middle; display: table-cell">
                        Спасибо за внимание!
                    </div>
                </div>
            </foreignObject>
        <g>
    </svg>
</section>

	<div class="progress"></div>
	<script src="../../js/common.js"></script>
	<script src="../../shower/shower.min.js"></script>
	<script src="../../highlight.js/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	



</body>
</html>
