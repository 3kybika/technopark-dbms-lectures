---
title: Лекция 4
description: |
  Тема данной лекции:

   - Разбор задач с РК1.
---
<section class="slide">
<h2>Задача 1</h2>
<p>Найти имена и классы, которые имеют друзей только в том же классе. Вернуть результат, отсортированный по классу, затем имени в классе.</p>
<h3>Схема:</h3>
<pre><code>Highschooler ( ID, name, grade )</code></pre>
<p>Студент с уникальным ID. Имя и Класс</p>
<pre><code>Friend ( ID1, ID2 )</code></pre>
<p>Студент с ID1 друг студента с ID2. Дружба взаимная, если есть запись (123, 456), то есть и (456, 123)</p>
</section>

<section class="slide">
<h2>Задача 1</h2>
<p>Найти имена и классы, которые имеют друзей только в том же классе. Вернуть результат, отсортированный по классу, затем имени в классе.</p>
<h3>Схема:</h3>
<pre><code>Highschooler ( ID, name, grade )</code></pre>
<p>Студент с уникальным ID. Имя и Класс</p>
<pre><code>Friend ( ID1, ID2 )</code></pre>
<p>Студент с ID1 друг студента с ID2. Дружба взаимная, если есть запись (123, 456), то есть и (456, 123)</p>
</section>

<section class="slide">
<h2>Задача 1</h2>
<p>Найти имена и классы, которые имеют друзей только в том же классе. Вернуть результат, отсортированный по классу, затем имени в классе.</p>
<div style="text-align: center">
	<img src="q1s01.svg" style="width: 75%" />
</div>
</section>

<section class="slide">
<h2>Задача 1</h2>
<p>Найти имена и классы, которые имеют друзей только в том же классе. Вернуть результат, отсортированный по классу, затем имени в классе.</p>
<div style="text-align: center">
	<img src="q1s02.svg" style="width: 75%" />
</div>
<p align="center">
	Есть в том же классе и нет в других классах<br/>==<br/>Есть друзья и нет в друих классах
</p>
</section>

<section class="slide">
<h2>Задача 1</h2>
<p>Найти имена и классы, которые имеют друзей только в том же классе. Вернуть результат, отсортированный по классу, затем имени в классе.</p>
<div style="text-align: center">
	<img src="q1s03.svg" style="width: 75%" />
</div>
<pre class="next" style="font-size: 80%; position: absolute;"><code class="sql">
<span style="display: none">SELECT H.name, H.grade</span>
FROM Highschooler AS H
JOIN Friend AS F ON (H.Id = F.Id1)
LEFT JOIN Highschooler AS O ON (F.Id2 = O.Id AND H.Grade &lt;&gt; O.Grade)
WHERE O.Id IS NULL
</code></pre>
<pre class="next" style="font-size: 80%"><code class="sql">
SELECT H.name, H.grade
<span style="display: none">FROM Highschooler AS H</span>
<span style="display: none">JOIN Friend AS F ON (H.Id = F.Id1)</span>
<span style="display: none">LEFT JOIN Highschooler AS O ON (F.Id2 = O.Id AND H.Grade &lt;&gt; O.Grade)</span>
<span style="display: none">WHERE O.Id IS NULL</span>
GROUP BY H.grade, H.name, H.id
ORDER BY H.grade, H.name
</code></pre>
</section>

<section class="slide">
<h2>Задача 2</h2>
<p>Найти разницу между средней оценкой фильмов выпущенных до 1980 года, а средней оценкой фильмов выпущенных после 1980 года (фильмы выпущенные в 1980 году не учитываются).</p>
<p>(Убедитесь, что для расчета используете среднюю оценку для каждого фильма. Не просто среднюю оценку фильмов до и после 1980 года.)</p>
<pre><code>
Movie (mID, title, year, director)
Rating (rID, mID, stars, ratingDate)
</code></pre>
</section>

<section class="slide">
<h2>Задача 2</h2>
<p>Найти разницу между средней оценкой фильмов выпущенных до 1980 года, а средней оценкой фильмов выпущенных после 1980 года (фильмы выпущенные в 1980 году не учитываются).</p>
<p>(Убедитесь, что для расчета используете среднюю оценку для каждого фильма. Не просто среднюю оценку фильмов до и после 1980 года.)</p>
<pre style="font-size: 80%; position: absolute"><code class="sql">
<span style="display: none">SELECT</span>
<span style="display: none">	AVG(CASE WHEN year > 1980 THEN stars ELSE NULL END) AS after,</span>
<span style="display: none">	AVG(CASE WHEN year < 1980 THEN stars ELSE NULL END) AS before</span>
<span style="display: none">FROM (</span>
	SELECT M.mID, M.year, AVG(R.stars) as stars
	FROM Movie M
	JOIN Rating R USING (mID)
	GROUP BY M.mID, M.year
<span style="display: none">) AS R</span>
</code></pre>
<pre class="next" style="font-size: 80%"><code class="sql">
SELECT
	AVG(CASE WHEN year > 1980 THEN stars ELSE NULL END) AS after,
	AVG(CASE WHEN year < 1980 THEN stars ELSE NULL END) AS before
FROM (
<span style="display: none">	SELECT M.mID, M.year, AVG(R.stars) as stars</span>
<span style="display: none">	FROM Movie M</span>
<span style="display: none">	JOIN Rating R USING (mID)</span>
<span style="display: none">	GROUP BY M.mID, M.year</span>
) AS R
</code></pre>
</section>

<section class="slide">
<h2>Задача 2</h2>
<p>Найти разницу между средней оценкой фильмов выпущенных до 1980 года, а средней оценкой фильмов выпущенных после 1980 года (фильмы выпущенные в 1980 году не учитываются).</p>
<p>(Убедитесь, что для расчета используете среднюю оценку для каждого фильма. Не просто среднюю оценку фильмов до и после 1980 года.)</p>
<pre style="font-size: 80%; position: absolute"><code class="sql">
SELECT
	AVG(CASE WHEN year > 1980 THEN stars ELSE NULL END) -
	AVG(CASE WHEN year < 1980 THEN stars ELSE NULL END) AS result
FROM (
	SELECT M.mID, M.year, AVG(R.stars) as stars
	FROM Movie M
	JOIN Rating R USING (mID)
	GROUP BY M.mID, M.year
) AS R
</code></pre>
</section>

<section class="slide">
<h2>Задача 2 (вариант 2)</h2>
<p>Найти разницу между средней оценкой фильмов выпущенных до 1980 года, а средней оценкой фильмов выпущенных после 1980 года (фильмы выпущенные в 1980 году не учитываются).</p>
<p>(Убедитесь, что для расчета используете среднюю оценку для каждого фильма. Не просто среднюю оценку фильмов до и после 1980 года.)</p>
<pre style="font-size: 80%; position: absolute"><code class="sql">
SELECT R.starts_after - R.starts_before AS result
FROM (
  SELECT
    AVG(CASE WHEN year > 1980 THEN stars ELSE NULL END) AS stars_after,
    AVG(CASE WHEN year < 1980 THEN stars ELSE NULL END) AS stars_before
  FROM Movie M 
  JOIN Rating R USING (mID)
  GROUP BY M.mID
) AS R
</code></pre>
</section>
